\documentclass[12pt, twoside]{article}
\usepackage{jmlda}
\newcommand{\hdir}{.}

% Здесь можно определять собственные команды, они будут действовать только внутри статьи:
\newenvironment{coderes}%
    {\medskip\tabcolsep=0pt\begin{tabular}{>{\small}l@{\quad}|@{\quad}l}}%
    {\end{tabular}\medskip}

\title
[Использование графовых моделей для прогнозирования продуктов химических реакций]
{Использование графовых моделей для прогнозирования продуктов химических реакций}
\author{Гунаев Руслан $^1$, Никитин Филипп$^1$, Стрижов Вадим$^1$}
\email{gunaev.rg@phystech.edu}
\organization{Московский физико-технический институт}
\abstract
    { Решается задача прямого синтеза химических элементов. Требуется определить количественный выход основного продукта химической реакции по молекулам исходных веществ. Данная задача является одной из ключевых для автоматизации процессов разработки лекарств, а именно входит в более общую проблему ретросинтеза химических элементов.  Предложенная модель использует экспертные знания для решения задачи. Качество решения задачи прямого синтеза измеряется по полному совпадению предсказанного и оригинального молекулярных графов основного продукта. 

\bigskip
\textbf{Ключевые слова}: \emph {ретросинтез маленьких молекул, прямой синтез, молекулярный граф}.}
\begin{document}

\maketitle
\section{Введение}

Исследование в области химинформатики можно разделить на две части: получение молекул - кандидатов, получение способов синтеза данного кондидата из известных, получаемых ранее веществ. Суть первой задачи заключается в создании таких молекулярных структур, например в виде молекулярного графов, которые, предположительно, обладают полезными свойствами: они не токсичны, взаимодействуют с другими соединениями.  Имеется множество исследований, направленых на автоматизацию данного процесса. В работе~\cite{schneider2005computer} были обозрены существовавшие концепты, нацеленные на использование вычислительных ресурсов для ускорения открытия новых веществ.  Развитие машинного обучения повлияло на развитие вычислительной химии и биологии~\cite{butler2018machine}. В частности, предприняты попытки генерировать предположения с помощью рекурентныйх нейронных сетей~\cite{olivecrona2017molecular, gomez2018automatic}, которые посимвольно генерировали строковое представление молекулы SMILES~\cite{weininger1988smiles}. Также для этой задачи применяются вариационные автокодировщики~\cite{dai2018syntax} и графовые нейронные сети~\cite{de2018molgan, duvenaud2015convolutional}.   

Цель второй задачи~--- это создание способа получения предлагаемой молекулы из уже ранее полученных веществ путем реализации цепочки реакций. При этом число реакций в цепочке не должно быть велико. Первые попытки автоматизировать решение задачи синтеза и ретросинтеза веществ были предприняты в 1969 ~\cite{corey1969computer}.

Cейчас активно развиваются методы глубинного обучения для решения поставленной задачи: предложен вариант использования neural machine translation~\cite{bahdanau2014neural}: продемонстрированы результаты модели перевода с рекурентными слоями~\cite{schwaller2018found}, а также Transformer модели ~\cite{schwaller2018molecular}.  В работе~\cite{coley2018graph} была построена графовая сверточная сеть, которая оценивала вероятность образования связи для заданных вершин.

В данной работе рассматриваться задача прямого синтеза. А именно рассматривается задача, в которой требуется по описаниям молекул исходных веществ определить молекулу основного продукта химической реакции как результата химического взаимодействия исходных веществ. В качестве представления молекул используются молекулярные графы. Поставленная задача решается как задача бинарной классификации вершин(атомов) в графе исходных веществ в два этапа. На пермом этапе атомы классифицируются по признаку принадлежности основному продукту. На втором этапе выделяются атомы, которые в процессе реакции изменили "локальную конфигурацию". Под локальной конфигурацией подразумевается совокупность вершины и смежных с ней ребер (типов связи).

В работе предложен метод классификации вершин в молеклярных графах исходных вешеств ~--- графе, состоящем из нескольких компонент. Решение базируется на модели Relational Graph convolution neural network~\cite{schlichtkrull2018modeling}. Предложено несколько модификаций, позволяющих использовать модель для классификации вершин в несвязанном графе. Более того данные модификации позволяют эффективно моделировать межмолекулярное взаимодействие, играющее ключевую роль в протекании реакций. Модель RGNN является обобщеним модели graph convolution neural network~\cite{kipf2016semi} для графов с различными типами ребер. В нашем случае это очень важно, так как ребрами в молекулярном графе являются типы химической связи: одинарная, двойная, тройная, ароматическая и тд. 


\section{Постановка задачи}
 
 В работе решается задача регрессии для количественного определения основного продукта химической реакции. Исходные вещества и реагенты могут быть представлены в виде нескольких молекулярных графов. В результате взаимодействия этих веществ образуются новые вещества. Представленный набор молекулярных графов исходных веществ и реагентов представляет собой множество неориентированных графов с различными типами ребер и вершин. Тип вершины -- номер химического элемента, тип ребра -- тип химической связи.
 

 
 \subsection{Расширенное представление графа}
 
 Для каждой молекулы добавим новую вершину и соединим ее с каждым атомом этой молекулы ребром особого типа. Далее создадим еще одну вершину и соединим ее со всеми ранее добавленными вершинами ребрами того же типа. 
 
 \subsection{Начальное скрытое представление атома}
 
 Каждый атом представлен несколькими категориальными признаками, такими как валентность, тип атома и др. Признаки будем обозначать $k_n, n \in \{1, \ldots K\}$.
 
 Для каждого из представленных категориальных признаков строится векторное вредставление (embedding). В формуле~\eqref{eq:cat_embed} используются обознаения: $i$~--- номер вершины в графе, $m_i$~--- тип вершины, $k$~--- номер признака, $W_k$~--- матрица весов для $k$-го категориального признака.

\begin{equation}
    \mathbf{h}_{i}^{(0)k} = W^k_{m_i}
    \label{eq:cat_embed}
\end{equation}

Итоговое преставление атома есть конкатенация эмбедингов $\mathbf{h}_{i}^{(0)k}$ по всем признакам~\eqref{eq:embed}.

\begin{equation}
    \mathbf{h}_{i}^{(0)} = [\mathbf{h}_{i}^{(0)0}, \mathbf{h}_{i}^{(0)1}, \mathbf{h}_{i}^{(0)2}, \dots, \mathbf{h}_{i}^{(0)K}]
    \label{eq:embed}
\end{equation}

 
 \subsection{Обновление скрытых состояний атома}
 
 В графовой сверточной нейронной сети обновление скрытых состояний происходит в соответствии с формулой~\eqref{eq:gcnn_update}. В этой формуле: $\sigma$~--- нелинейность, $N_i$~--- множество индексов атомов смежных с $i$-м, $c_i$~--- нормализационный фактор.  

\begin{equation}
    \mathbf{h}^{(l+1)}_i = \sigma \left(W^{(l)}\mathbf{h}^{(l)}_j + \sum \limits_{j \in N_i} \frac{1}{c_i} W^{(l)}\mathbf{h}^{(l)}_j \right) 
    \label{eq:gcnn_update}
\end{equation}

Недостатком данной модели является предположение о том, что все связи между вершинами эдентичны. Для предсказаний высокой точности необходимо, чтобы модель выучивала типы связей в процессе обучения.В связи с тем, что информация о типе связи между атомами известна, то подход выглядит недостаточно рациональным. Эту проблему решает RGCNN, обновление скрытых состояний в которой происходит в соответствии с формулой~\eqref{eq:rgcnn_update}. В данной модели смежные с заданной вершиной разным типом связи атомы учитываются с разными весами.  

\begin{equation}
    \mathbf{h}_{(l+1)}^i = \sigma \left( W^{(l)}\mathbf{h}^{(l)} + \sum \limits_{r \in R}\sum \limits_{j \in N_i} \frac{1}{c_{i, r}} W^{(l)}_r \mathbf{h}^{(l)}_j \right) 
    \label{eq:rgcnn_update}
\end{equation}


\bibliography{literature}{}
\bibliographystyle{plain}

\end{document}
